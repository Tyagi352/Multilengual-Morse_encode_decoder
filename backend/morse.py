# backend/morse.py

from flask import Flask, request, jsonify
from flask_cors import CORS
from indic_transliteration import sanscript
from indic_transliteration.sanscript import transliterate

app = Flask(__name__)
CORS(app)


# Morse code dictionaries for English and major Indian scripts
MORSE_CODE_DICTS = {
    "en": {
        "A": ".-", "B": "-...", "C": "-.-.", "D": "-..", "E": ".",
        "F": "..-.", "G": "--.", "H": "....", "I": "..", "J": ".---",
        "K": "-.-", "L": ".-..", "M": "--", "N": "-.", "O": "---",
        "P": ".--.", "Q": "--.-", "R": ".-.", "S": "...", "T": "-",
        "U": "..-", "V": "...-", "W": ".--", "X": "-..-", "Y": "-.--",
        "Z": "--..", "1": ".----", "2": "..---", "3": "...--", "4": "....-",
        "5": ".....", "6": "-....", "7": "--...", "8": "---..", "9": "----.",
        "0": "-----", ",": "--..--", ".": ".-.-.-", "?": "..--..", "/": "-..-.",
        "-": "-....-", "(": "-.--.", ")": "-.--.-"
    },
    # Hindi (Devanagari)
    "hi": {
        "अ": ".-", "आ": "-...", "इ": "-.-.", "ई": "-..", "उ": ".",
        "ऊ": "..-.", "ए": "--.", "ऐ": "....", "ओ": "..", "औ": ".---",
        "क": "-.-", "ख": ".-..", "ग": "--", "घ": "-.", "च": "---",
        "छ": ".--.", "ज": "--.-", "झ": ".-.", "ट": "...", "ठ": "-",
        "ड": "..-", "ढ": "...-", "ण": ".--", "त": "-..-", "थ": "-.--",
        "द": "--..", "ध": ".----", "न": "..---", "प": "...--", "फ": "....-",
        "ब": ".....", "भ": "-....", "म": "--...", "य": "---..", "र": "----.",
        "ल": "-----", "व": "--..--", "श": ".-.-.-", "ष": "..--..", "स": "-..-.",
        "ह": "-....-", "क्ष": "-.--.", "त्र": "-.--.-",

         "ा": ".-.-", "ि": "-..-.", "ी": "..-..", "ु": "---.", "ू": ".--..",
    "े": "..-.-", "ै": "-.-..", "ो": "--.-.", "ौ": "-.--.."
    },
    # Gujarati
    "gu": {
        "અ": ".-", "આ": "-...", "ઇ": "-.-.", "ઈ": "-..", "ઉ": ".",
        "ઊ": "..-.", "એ": "--.", "ઐ": "....", "ઓ": "..", "ઔ": ".---",
        "ક": "-.-", "ખ": ".-..", "ગ": "--", "ઘ": "-.", "ચ": "---",
        "છ": ".--.", "જ": "--.-", "ઝ": ".-.", "ટ": "...", "ઠ": "-",
        "ડ": "..-", "ઢ": "...-", "ણ": ".--", "ત": "-..-", "થ": "-.--",
        "દ": "--..", "ધ": ".----", "ન": "..---", "પ": "...--", "ફ": "....-",
        "બ": ".....", "ભ": "-....", "મ": "--...", "ય": "---..", "ર": "----.",
        "લ": "-----", "વ": "--..--", "શ": ".-.-.-", "ષ": "..--..", "સ": "-..-.",
        "હ": "-....-", "ક્ષ": "-.--.", "ત્ર": "-.--.-"
    },
    # Tamil
    "ta": {
        "அ": ".-", "ஆ": "-...", "இ": "-.-.", "ஈ": "-..", "உ": ".",
        "ஊ": "..-.", "எ": "--.", "ஏ": "....", "ஐ": "..", "ஒ": ".---",
        "ஓ": "-.-", "ஔ": ".-..", "க": "--", "ங": "-.", "ச": "---",
        "ஞ": ".--.", "ட": "--.-", "ண": ".-.", "த": "...", "ந": "-",
        "ப": "..-", "ம": "...-", "ய": ".--", "ர": "-..-", "ல": "-.--",
        "வ": "--..", "ழ": ".----", "ள": "..---", "ற": "...--", "ஷ": "....-",
        "ஸ": ".....", "ஹ": "-...."
    },
    # Telugu
    "te": {
        "అ": ".-", "ఆ": "-...", "ఇ": "-.-.", "ఈ": "-..", "ఉ": ".",
        "ఊ": "..-.", "ఎ": "--.", "ఏ": "....", "ఐ": "..", "ఒ": ".---",
        "ఓ": "-.-", "ఔ": ".-..", "క": "--", "ఖ": "-.", "గ": "---",
        "ఘ": ".--.", "చ": "--.-", "ఛ": ".-.", "జ": "...", "ఝ": "-",
        "ట": "..-", "ఠ": "...-", "డ": ".--", "ఢ": "-..-", "ణ": "-.--",
        "త": "--..", "థ": ".----", "ద": "..---", "ధ": "...--", "న": "....-",
        "ప": ".....", "ఫ": "-....", "బ": "--...", "భ": "---..", "మ": "----.",
        "య": "-----", "ర": "--..--", "ల": ".-.-.-", "వ": "..--..", "శ": "-..-.",
        "ష": "-....-", "స": "-.--.", "హ": "-.--.-"
    },
    # Bengali
    "bn": {
        "অ": ".-", "আ": "-...", "ই": "-.-.", "ঈ": "-..", "উ": ".",
        "ঊ": "..-.", "এ": "--.", "ঐ": "....", "ও": "..", "ঔ": ".---",
        "ক": "-.-", "খ": ".-..", "গ": "--", "ঘ": "-.", "চ": "---",
        "ছ": ".--.", "জ": "--.-", "ঝ": ".-.", "ট": "...", "ঠ": "-",
        "ড": "..-", "ঢ": "...-", "ণ": ".--", "ত": "-..-", "থ": "-.--",
        "দ": "--..", "ধ": ".----", "ন": "..---", "প": "...--", "ফ": "....-",
        "ব": ".....", "ভ": "-....", "ম": "--...", "য": "---..", "র": "----.",
        "ল": "-----", "শ": "--..--", "ষ": ".-.-.-", "স": "..--..", "হ": "-..-.",
        "ক্ষ": "-....-", "ত্র": "-.--.", "জ্ঞ": "-.--.-"
    },
    # Kannada
    "kn": {
        "ಅ": ".-", "ಆ": "-...", "ಇ": "-.-.", "ಈ": "-..", "ಉ": ".",
        "ಊ": "..-.", "ಎ": "--.", "ಏ": "....", "ಐ": "..", "ಒ": ".---",
        "ಓ": "-.-", "ಔ": ".-..", "ಕ": "--", "ಖ": "-.", "ಗ": "---",
        "ಘ": ".--.", "ಚ": "--.-", "ಛ": ".-.", "ಜ": "...", "ಝ": "-",
        "ಟ": "..-", "ಠ": "...-", "ಡ": ".--", "ಢ": "-..-", "ಣ": "-.--",
        "ತ": "--..", "ಥ": ".----", "ದ": "..---", "ಧ": "...--", "ನ": "....-",
        "ಪ": ".....", "ಫ": "-....", "ಬ": "--...", "ಭ": "---..", "ಮ": "----.",
        "ಯ": "-----", "ರ": "--..--", "ಲ": ".-.-.-", "ವ": "..--..", "ಶ": "-..-.",
        "ಷ": "-....-", "ಸ": "-.--.", "ಹ": "-.--.-"
    },
    # Punjabi (Gurmukhi)
    "pa": {
        "ਅ": ".-", "ਆ": "-...", "ਇ": "-.-.", "ਈ": "-..", "ਉ": ".",
        "ਊ": "..-.", "ਏ": "--.", "ਐ": "....", "ਓ": "..", "ਔ": ".---",
        "ਕ": "-.-", "ਖ": ".-..", "ਗ": "--", "ਘ": "-.", "ਚ": "---",
        "ਛ": ".--.", "ਜ": "--.-", "ਝ": ".-.", "ਟ": "...", "ਠ": "-",
        "ਡ": "..-", "ਢ": "...-", "ਣ": ".--", "ਤ": "-..-", "ਥ": "-.--",
        "ਦ": "--..", "ਧ": ".----", "ਨ": "..---", "ਪ": "...--", "ਫ": "....-",
        "ਬ": ".....", "ਭ": "-....", "ਮ": "--...", "ਯ": "---..", "ਰ": "----.",
        "ਲ": "-----", "ਵ": "--..--", "ਸ਼": ".-.-.-", "ਸ": "..--..", "ਹ": "-..-.",
        "ਖ਼": "-....-", "ਗ਼": "-.--.", "ਜ਼": "-.--.-"
    }
}

def get_morse_dict(lang_code):
    return MORSE_CODE_DICTS.get(lang_code, MORSE_CODE_DICTS["en"])

def get_morse_reverse_dict(lang_code):
    morse_dict = get_morse_dict(lang_code)
    return {value: key for key, value in morse_dict.items()}


def encrypt(message: str, lang_code: str) -> str:
    """Convert plain text (any supported language) to Morse code using native script mapping, with readable spacing."""
    morse_dict = get_morse_dict(lang_code)
    words = message.split()
    morse_words = []
    for word in words:
        morse_letters = [morse_dict.get(char, "") for char in word if char.strip()]
        morse_words.append(" ".join(morse_letters))
    return "   ".join(morse_words)

def decrypt(message: str, lang_code: str) -> str:
    """Convert Morse code back to native script text (in selected language)"""
    morse_reverse = get_morse_reverse_dict(lang_code)
    words = message.strip().split("   ")
    decoded_words = []
    for word in words:
        letters = word.split(" ")
        decoded_letters = [morse_reverse.get(letter, "") for letter in letters if letter]
        decoded_word = "".join(decoded_letters)
        decoded_words.append(decoded_word)
    return " ".join(decoded_words)


# ...existing code...
# The encrypt and decrypt functions are now defined above using native script Morse logic

# API routes
@app.route("/encode", methods=["POST"])
def encode_text():
    data = request.get_json(force=True)
    text = data.get("text", "")
    lang = data.get("lang", "en")
    return jsonify({"result": encrypt(text, lang)})

@app.route("/decode", methods=["POST"])
def decode_text():
    data = request.get_json(force=True)
    text = data.get("text", "  ")
    lang = data.get("lang", "en")
    return jsonify({"result": decrypt(text, lang)})

if __name__ == "__main__":
    app.run(debug=True)
